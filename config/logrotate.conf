# logrotate configuration for Mac Mini server
# System-wide log rotation configuration
#
# This file will be copied to /opt/homebrew/etc/logrotate.conf during setup

# Global settings
# Rotate logs weekly by default
weekly

# Keep 4 weeks of logs by default
rotate 4

# Create new log files after rotation
create

# Use date as suffix instead of numbers
dateext

# Compress rotated logs (except the most recent)
compress
delaycompress

# Include additional config files
include /opt/homebrew/etc/logrotate.d

# Mac Mini server logs in ~/.local/state/
/Users/*/.local/state/*-setup.log
/Users/*/.local/state/*-apps.log
/Users/*/.local/state/*-operator-login.log
/Users/*/.local/state/*-plex-startup.log
/Users/*/.local/state/*-mount.log
/Users/*/.local/state/com.*-mount-nas-media.log
/Users/*/.local/state/*-plex-launchagent.log
/Users/*/.local/state/com.*-operator-first-login.log
{
    # Rotate when logs reach 10MB or daily, whichever comes first
    size 10M
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Don't rotate if log file is missing
    missingok
    
    # Don't rotate empty log files
    notifempty
    
    # Create new log file with same ownership/permissions as original
    copytruncate
    
    # Compress rotated logs
    compress
    delaycompress
    
    # Use date format YYYYMMDD
    dateformat -%Y%m%d
    
    # Clean up temp files after rotation
    postrotate
        # Clean up temporary rsync logs older than 7 days
        find /tmp -name "plex_rsync_*.log" -mtime +7 -delete 2>/dev/null || true
        find /tmp -name "brew-doctor-*.log" -mtime +7 -delete 2>/dev/null || true
    endscript
}